(function(define){var __define;"function"==typeof define&&define.amd&&(__define=define,define=null);
function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire1d24;n.register("2Vsq5",(function(t,r){var o;o=t.exports,Object.defineProperty(o,"__esModule",{value:!0,configurable:!0}),e(t.exports,"default",(function(){return S}),(function(e){return S=e}));var i,u=n("e5ps5"),c=n("gWrUf"),a=n("h6NoS"),s=n("krsE8"),l=n("iBvu5"),f=n("6rT8n").Buffer,d=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,c)}a((r=r.apply(e,t||[])).next())}))},h=function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},v=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u},y=[{vendorId:a.ledgerUSBVendorId}],g=function(){return Promise.resolve(!(!window.navigator||!window.navigator.hid))},b=function(){var e=navigator.hid;if(!e)throw new(0,l.TransportError)("navigator.hid is not supported","HIDNotSupported");return e};function m(){return p(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,b().requestDevice({filters:y})];case 1:return e=t.sent(),Array.isArray(e)?[2,e]:[2,[e]]}}))}))}function w(){return p(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,b().getDevices()];case 1:return[2,e.sent().filter((function(e){return e.vendorId===a.ledgerUSBVendorId}))]}}))}))}var S=function(e){function t(t){var n=e.call(this)||this;return n.channel=Math.floor(65535*Math.random()),n.packetSize=64,n.inputs=[],n.read=function(){return n.inputs.length?Promise.resolve(n.inputs.shift()):new Promise((function(e){n.inputCallback=e}))},n.onInputReport=function(e){var t=f.from(e.data.buffer);n.inputCallback?(n.inputCallback(t),n.inputCallback=null):n.inputs.push(t)},n._disconnectEmitted=!1,n._emitDisconnect=function(e){n._disconnectEmitted||(n._disconnectEmitted=!0,n.emit("disconnect",e))},n.exchange=function(e){return p(n,void 0,void 0,(function(){var t=this;return h(this,(function(n){switch(n.label){case 0:return[4,this.exchangeAtomicImpl((function(){return p(t,void 0,void 0,(function(){var t,n,r,o,i,u,a,l,f;return h(this,(function(d){switch(d.label){case 0:n=(t=this).channel,r=t.packetSize,(0,s.log)("apdu","=> "+e.toString("hex")),o=(0,c.default)(n,r),i=o.makeBlocks(e),u=0,d.label=1;case 1:return u<i.length?[4,this.device.sendReport(0,i[u])]:[3,4];case 2:d.sent(),d.label=3;case 3:return u++,[3,1];case 4:return(a=o.getReducedResult(l))?[3,6]:[4,this.read()];case 5:return f=d.sent(),l=o.reduceResponse(l,f),[3,4];case 6:return(0,s.log)("apdu","<= "+a.toString("hex")),[2,a]}}))}))})).catch((function(e){if(e&&e.message&&e.message.includes("write"))throw t._emitDisconnect(e),new(0,l.DisconnectedDeviceDuringOperation)(e.message);throw e}))];case 1:return[2,n.sent()]}}))}))},n.device=t,n.deviceModel="number"==typeof t.productId?(0,a.identifyUSBProductId)(t.productId):void 0,t.addEventListener("inputreport",n.onInputReport),n}return d(t,e),t.request=function(){return p(this,void 0,void 0,(function(){var e,n;return h(this,(function(r){switch(r.label){case 0:return[4,m()];case 1:return e=v.apply(void 0,[r.sent(),1]),n=e[0],[2,t.open(n)]}}))}))},t.openConnected=function(){return p(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return[4,w()];case 1:return 0===(e=n.sent()).length?[2,null]:[2,t.open(e[0])]}}))}))},t.open=function(e){return p(this,void 0,void 0,(function(){var n,r;return h(this,(function(o){switch(o.label){case 0:return[4,e.open()];case 1:return o.sent(),n=new t(e),r=function(t){e===t.device&&(b().removeEventListener("disconnect",r),n._emitDisconnect(new(0,l.DisconnectedDevice)))},b().addEventListener("disconnect",r),[2,n]}}))}))},t.prototype.close=function(){return p(this,void 0,void 0,(function(){return h(this,(function(e){switch(e.label){case 0:return[4,this.exchangeBusyPromise];case 1:return e.sent(),this.device.removeEventListener("inputreport",this.onInputReport),[4,this.device.close()];case 2:return e.sent(),[2]}}))}))},t.prototype.setScrambleKey=function(){},t.isSupported=g,t.list=w,t.listen=function(e){var t=!1;return function(){return p(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return[4,w()];case 1:return(e=t.sent()).length>0?[2,e[0]]:[4,m()];case 2:return[2,t.sent()[0]]}}))}))}().then((function(n){if(n){if(!t){var r="number"==typeof n.productId?(0,a.identifyUSBProductId)(n.productId):void 0;e.next({type:"add",descriptor:n,deviceModel:r}),e.complete()}}else e.error(new(0,l.TransportOpenUserCancelled)("Access denied to use Ledger device"))}),(function(t){e.error(new(0,l.TransportOpenUserCancelled)(t.message))})),{unsubscribe:function(){t=!0}}},t}(u.default)})),n.register("e5ps5",(function(r,o){e(r.exports,"default",(function(){return h}),(function(e){return h=e})),e(r.exports,"TransportError",(function(){return n("iBvu5").TransportError}),(function(e){return n("iBvu5").TransportError=e})),e(r.exports,"TransportStatusError",(function(){return n("iBvu5").TransportStatusError}),(function(e){return n("iBvu5").TransportStatusError=e})),e(r.exports,"StatusCodes",(function(){return n("iBvu5").StatusCodes}),(function(e){return n("iBvu5").StatusCodes=e})),e(r.exports,"getAltStatusMessage",(function(){return $a415468fbc832053$re_export$getAltStatusMessage}),(function(e){return $a415468fbc832053$re_export$getAltStatusMessage=e}));var i=n("2p5of"),u=n("iBvu5"),c=n("6rT8n").Buffer,a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(u,c)}a((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,r=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},l=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),u=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)u.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return u},f=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},d=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},p=function(){function e(){var e=this;this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new(t(i)),this.send=function(t,n,r,o,i,l){return void 0===i&&(i=c.alloc(0)),void 0===l&&(l=[u.StatusCodes.OK]),a(e,void 0,void 0,(function(){var e,a;return s(this,(function(s){switch(s.label){case 0:if(i.length>=256)throw new(0,u.TransportError)("data.length exceed 256 bytes limit. Got: "+i.length,"DataLengthTooBig");return[4,this.exchange(c.concat([c.from([t,n,r,o]),c.from([i.length]),i]))];case 1:if(e=s.sent(),a=e.readUInt16BE(e.length-2),!l.some((function(e){return e===a})))throw new(0,u.TransportStatusError)(a);return[2,e]}}))}))},this.exchangeAtomicImpl=function(t){return a(e,void 0,void 0,(function(){var e,n,r,o,i,c=this;return s(this,(function(a){switch(a.label){case 0:if(this.exchangeBusyPromise)throw new(0,u.TransportRaceCondition)("An action was already pending on the Ledger device. Please deny or reconnect.");n=new Promise((function(t){e=t})),this.exchangeBusyPromise=n,r=!1,o=setTimeout((function(){r=!0,c.emit("unresponsive")}),this.unresponsiveTimeout),a.label=1;case 1:return a.trys.push([1,,3,4]),[4,t()];case 2:return i=a.sent(),r&&this.emit("responsive"),[2,i];case 3:return clearTimeout(o),e&&e(),this.exchangeBusyPromise=null,[7];case 4:return[2]}}))}))},this._appAPIlock=null}return e.prototype.exchange=function(e){throw new Error("exchange not implemented")},e.prototype.setScrambleKey=function(e){},e.prototype.close=function(){return Promise.resolve()},e.prototype.on=function(e,t){this._events.on(e,t)},e.prototype.off=function(e,t){this._events.removeListener(e,t)},e.prototype.emit=function(e){for(var t,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];(t=this._events).emit.apply(t,f([e],l(n),!1))},e.prototype.setDebugMode=function(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")},e.prototype.setExchangeTimeout=function(e){this.exchangeTimeout=e},e.prototype.setExchangeUnresponsiveTimeout=function(e){this.unresponsiveTimeout=e},e.create=function(e,t){var n=this;return void 0===e&&(e=3e3),new Promise((function(r,o){var i=!1,c=n.listen({next:function(t){i=!0,c&&c.unsubscribe(),a&&clearTimeout(a),n.open(t.descriptor,e).then(r,o)},error:function(e){a&&clearTimeout(a),o(e)},complete:function(){a&&clearTimeout(a),i||o(new(0,u.TransportError)(n.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),a=t?setTimeout((function(){c.unsubscribe(),o(new(0,u.TransportError)(n.ErrorMessage_ListenTimeout,"ListenTimeout"))}),t):null}))},e.prototype.decorateAppAPIMethods=function(e,t,n){var r,o;try{for(var i=d(t),u=i.next();!u.done;u=i.next()){var c=u.value;e[c]=this.decorateAppAPIMethod(c,e[c],e,n)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.decorateAppAPIMethod=function(e,t,n,r){var o=this;return function(){for(var i=[],c=0;c<arguments.length;c++)i[c]=arguments[c];return a(o,void 0,void 0,(function(){var o;return s(this,(function(c){switch(c.label){case 0:if(o=this._appAPIlock)return[2,Promise.reject(new(0,u.TransportError)("Ledger Device is busy (lock "+o+")","TransportLocked"))];c.label=1;case 1:return c.trys.push([1,,3,4]),this._appAPIlock=e,this.setScrambleKey(r),[4,t.apply(n,i)];case 2:return[2,c.sent()];case 3:return this._appAPIlock=null,[7];case 4:return[2]}}))}))}},e.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",e.ErrorMessage_NoDeviceFound="No Ledger device found",e}(),h=p})),n.register("gWrUf",(function(t,r){var o;e(t.exports,"default",(function(){return o}),(function(e){return o=e}));var i=n("6rT8n").Buffer;var u=n("iBvu5");var c={data:i.alloc(0),dataLength:0,sequence:0};o=function(e,t){return{makeBlocks:function(n){var r,o,u=i.concat([(r=n.length,o=i.alloc(2),o.writeUInt16BE(r,0),o),n]),c=t-5,a=Math.ceil(u.length/c);u=i.concat([u,i.alloc(a*c-u.length+1).fill(0)]);for(var s=[],l=0;l<a;l++){var f=i.alloc(5);f.writeUInt16BE(e,0),f.writeUInt8(5,2),f.writeUInt16BE(l,3);var d=u.slice(l*c,(l+1)*c);s.push(i.concat([f,d]))}return s},reduceResponse:function(t,n){var r=t||c,o=r.data,a=r.dataLength,s=r.sequence;if(n.readUInt16BE(0)!==e)throw new u.TransportError("Invalid channel","InvalidChannel");if(5!==n.readUInt8(2))throw new u.TransportError("Invalid tag","InvalidTag");if(n.readUInt16BE(3)!==s)throw new u.TransportError("Invalid sequence","InvalidSequence");t||(a=n.readUInt16BE(5)),s++;var l=n.slice(t?5:7);return(o=i.concat([o,l])).length>a&&(o=o.slice(0,a)),{data:o,dataLength:a,sequence:s}},getReducedResult:function(e){if(e&&e.dataLength===e.data.length)return e.data}}}})),n.register("h6NoS",(function(r,o){e(r.exports,"ledgerUSBVendorId",(function(){return d}),(function(e){return d=e})),e(r.exports,"identifyUSBProductId",(function(){return p}),(function(e){return p=e}));var i,u,c,a=n("3sixR"),s=function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},s.apply(this,arguments)};(c=u||(u={})).blue="blue",c.nanoS="nanoS",c.nanoSP="nanoSP",c.nanoX="nanoX";var l=((i={})[u.blue]={id:u.blue,productName:"Ledger Blue",productIdMM:0,legacyUsbProductId:0,usbOnly:!0,memorySize:491520,masks:[822083584,822149120],getBlockSize:function(e){return 4096}},i[u.nanoS]={id:u.nanoS,productName:"Ledger Nano S",productIdMM:16,legacyUsbProductId:1,usbOnly:!0,memorySize:327680,masks:[823132160],getBlockSize:function(e){var n;return t(a).lt(null!==(n=t(a).coerce(e))&&void 0!==n?n:"","2.0.0")?4096:2048}},i[u.nanoSP]={id:u.nanoSP,productName:"Ledger Nano SP",productIdMM:80,legacyUsbProductId:5,usbOnly:!0,memorySize:1569792,masks:[856686592],getBlockSize:function(e){return 32}},i[u.nanoX]={id:u.nanoX,productName:"Ledger Nano X",productIdMM:64,legacyUsbProductId:4,usbOnly:!1,memorySize:2097152,masks:[855638016],getBlockSize:function(e){return 4096},bluetoothSpec:[{serviceUuid:"d973f2e0-b19e-11e2-9e96-0800200c9a66",notifyUuid:"d973f2e1-b19e-11e2-9e96-0800200c9a66",writeUuid:"d973f2e2-b19e-11e2-9e96-0800200c9a66",writeCmdUuid:"d973f2e3-b19e-11e2-9e96-0800200c9a66"},{serviceUuid:"13d63400-2c97-0004-0000-4c6564676572",notifyUuid:"13d63400-2c97-0004-0001-4c6564676572",writeUuid:"13d63400-2c97-0004-0002-4c6564676572",writeCmdUuid:"13d63400-2c97-0004-0003-4c6564676572"}]},i),f=(u.blue,u.nanoS,u.nanoX,Object.values(l)),d=11415,p=function(e){var t=f.find((function(t){return t.legacyUsbProductId===e}));if(t)return t;var n=e>>8;return f.find((function(e){return e.productIdMM===n}))},h=[],v={};for(var y in l){var g=l[y],b=g.bluetoothSpec;if(b)for(var m=0;m<b.length;m++){var w=b[m];h.push(w.serviceUuid),v[w.serviceUuid]=v[w.serviceUuid.replace(/-/g,"")]=s({deviceModel:g},w)}}})),n.register("krsE8",(function(t,n){e(t.exports,"log",(function(){return i}));var r=0,o=[],i=function(e,t,n){var i={type:e,id:String(++r),date:new Date};t&&(i.message=t),n&&(i.data=n),function(e){for(var t=0;t<o.length;t++)try{o[t](e)}catch(e){console.error(e)}}(i)};"undefined"!=typeof window&&(window.__ledgerLogsListen=function(e){return o.push(e),function(){var t=o.indexOf(e);-1!==t&&(o[t]=o[o.length-1],o.pop())}})}));
//# sourceMappingURL=TransportWebHID.6ce3c950.js.map
define=__define;})(window.define);